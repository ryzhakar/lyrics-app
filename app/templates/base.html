<!doctype html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Lyrics App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Roboto+Slab:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/base.css" />
  </head>
  <body class="{{ 'dark' if dark else '' }} font-{{ font or 'normal' }}">
    <nav class="topbar">
      <div class="topbar-row">
        <a href="/" class="brand" aria-label="Home">Lyrics</a>
        <form action="/search" method="get" class="search">
          <input type="search" name="q" placeholder="Searchâ€¦" value="{{ query or '' }}" />
        </form>
        <div class="actions">
          <button type="button" class="icon-btn" id="theme-toggle" aria-label="Toggle theme" title="Toggle theme">
            <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true"><path fill="currentColor" d="M12 3a9 9 0 1 0 9 9 7 7 0 0 1-9-9Z"/></svg>
          </button>
          <button type="button" class="icon-btn" id="chords-toggle" aria-label="Toggle chords" title="Toggle chords">
            <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true"><path fill="currentColor" d="M4 12s4-7 8-7 8 7 8 7-4 7-8 7-8-7-8-7Zm8-3a3 3 0 1 1 0 6 3 3 0 0 1 0-6Z"/></svg>
          </button>
          <button type="button" class="icon-btn" id="share-link" aria-label="Share" title="Share link">
            <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true"><path fill="currentColor" d="M15 8a3 3 0 1 0-3-3v7l-4 2a3 3 0 1 0 .9 1.79L12 14l0-9"/></svg>
          </button>
        </div>
      </div>
    </nav>
    <main class="container">
      {% block content %}{% endblock %}
    </main>
    <div id="toast" class="toast" role="status" aria-live="polite" aria-hidden="true"></div>
    <script>
      (function(){
        const qs = new URLSearchParams(window.location.search);
        const s = qs.get('s') || '';
        const font = qs.get('font') || '';
        const dark = qs.get('dark');
        const chords = qs.get('chords');
        function setParam(name, value){
          const q = new URLSearchParams(window.location.search);
          if(value === null){ q.delete(name); } else { q.set(name, value); }
          window.location.search = q.toString();
        }
        document.getElementById('theme-toggle').addEventListener('click', function(){
          const cur = (qs.get('dark')||'0') === '1';
          setParam('dark', cur ? '0' : '1');
        });
        document.getElementById('chords-toggle').addEventListener('click', function(){
          const cur = (qs.get('chords')||'1') === '1';
          setParam('chords', cur ? '0' : '1');
        });
        function showToast(text){
          const el = document.getElementById('toast');
          el.textContent = text; el.setAttribute('aria-hidden','false');
          el.classList.add('show');
          setTimeout(()=>{ el.classList.remove('show'); el.setAttribute('aria-hidden','true');}, 1600);
        }
        document.getElementById('share-link').addEventListener('click', async function(){
          const url = window.location.href;
          try{
            if(navigator.share){ await navigator.share({url}); return; }
            await navigator.clipboard.writeText(url);
            showToast('Link copied');
          }catch{ showToast('Could not share'); }
        });
        // Auto-hide topbar on scroll
        let lastY = window.scrollY; let hidden = false;
        window.addEventListener('scroll', () => {
          const y = window.scrollY;
          if(y > lastY + 16 && !hidden){ document.querySelector('.topbar').classList.add('hide'); hidden = true; }
          else if(y < lastY - 16 && hidden){ document.querySelector('.topbar').classList.remove('hide'); hidden = false; }
          lastY = y;
        }, {passive:true});
      })();
    </script>
  </body>
</html>
